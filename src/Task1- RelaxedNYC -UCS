from queue import PriorityQueue
from misc import PathInfo, calc_path_distance

def ucs(source: str, dest: str, dist: dict, g: dict) -> PathInfo:
    """ Super simple UCS, no heuristics or anything. Just using known neighbour distances

    Args:
        source (str): Source node
        dest (str): Destination node
        dist (dict): Dictionary of distances between 2 nodes
        g (dict): Dictionary of neighbors, given a node as its key

    Returns:
        PathInfo: Object containing all information needed to be printed
    """

    # Using a priority queue for ease of retrieving the current shortest path
    prio_queue = PriorityQueue()

    # Priority queue item is such: ( $path_taken: list )
    prio_queue.put((0, [source]))

    # Nodes to not revisit accidentally
    visited = set()

    while not prio_queue.empty():
        pair = prio_queue.get()
        current_path = pair[1]

        # Current node will be the last node in the path taken
        current_node = current_path[-1]

        # Explore node if it hasn't already been visited
        if current_node not in visited:
            visited.add(current_node)

            # Return path taken if the node is the destination
            if current_node == dest:
                path_info = PathInfo()
                path_info.path = "->".join(current_path)
                path_info.dist = calc_path_distance(current_path, dist)
                path_info.energy = "Not considered"
                return path_info

            # Add paths for neighboring nodes into the priority queue
            for neighbor in g[current_node]:
                new_dist = dist[f"{current_node},{neighbor}"]
                score = pair[0] + new_dist

                new_path = list(pair[1])
                new_path.append(neighbor)

                prio_queue.put((score, new_path))

    return PathInfo()
